import{r as u,u as S,x as E,y as n,B as h,j as e,a as i,b as r,c as N,z as w,d as B,e as P,f as g,bM as A,T as p,i as C}from"./index-CQXiZoZy.js";const M=()=>{const[s,m]=u.useState({title:"",description:"",status:"To Do",priority:"Medium",dueDate:"",assignedTo:"",project:""}),[f,v]=u.useState([]),[k,y]=u.useState([]),x=S(),{id:j}=E();u.useEffect(()=>{T(),b()},[j]);const T=async()=>{var t,a;try{const l=localStorage.getItem("token");if(!l){n.error("No authentication token found");return}const c=await h.get(`http://localhost:3001/api/tasks/${j}`,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(c.data&&c.data.success&&c.data.task){const d=c.data.task;m({...d,dueDate:d.dueDate?new Date(d.dueDate).toISOString().split("T")[0]:"",assignedTo:((t=d.assignedTo)==null?void 0:t._id)||"",project:((a=d.project)==null?void 0:a._id)||""})}else throw new Error("Task data not found or invalid response format")}catch(l){console.error("Erreur lors de la récupération de la tâche:",l),n.error("Erreur lors de la récupération de la tâche.")}},b=async()=>{try{const t=localStorage.getItem("token");if(!t){n.error("No authentication token found");return}const a={headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}},[l,c]=await Promise.all([h.get("http://localhost:3001/api/projects",a),h.get("http://localhost:3001/api/auth/users",a)]);v(l.data.projects||[]),y(c.data.users||[])}catch(t){console.error("Erreur lors de la récupération des projets ou utilisateurs:",t),n.error("Erreur lors de la récupération des projets ou utilisateurs.")}},o=t=>{m({...s,[t.target.name]:t.target.value})},D=async t=>{t.preventDefault();try{const a=localStorage.getItem("token");if(!a){n.error("No authentication token found");return}await h.put(`http://localhost:3001/api/tasks/${j}`,s,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),n.success("Tâche modifiée avec succès !"),x("/tasks")}catch(a){console.error("Erreur lors de la modification de la tâche:",a),n.error("Erreur lors de la modification de la tâche.")}};return e.jsx(i,{children:e.jsx(r,{children:e.jsxs(N,{children:[e.jsx(w,{children:e.jsx("strong",{children:"Modifier la tâche"})}),e.jsx(B,{children:e.jsxs(P,{onSubmit:D,children:[e.jsx(i,{className:"mb-3",children:e.jsx(r,{children:e.jsx(g,{label:"Titre",name:"title",value:s.title,onChange:o,required:!0})})}),e.jsx(i,{className:"mb-3",children:e.jsx(r,{children:e.jsx(A,{label:"Description",name:"description",value:s.description,onChange:o,required:!0})})}),e.jsxs(i,{className:"mb-3",children:[e.jsx(r,{children:e.jsxs(p,{label:"Statut",name:"status",value:s.status,onChange:o,children:[e.jsx("option",{value:"To Do",children:"À faire"}),e.jsx("option",{value:"In Progress",children:"En cours"}),e.jsx("option",{value:"Done",children:"Terminé"})]})}),e.jsx(r,{children:e.jsxs(p,{label:"Priorité",name:"priority",value:s.priority,onChange:o,children:[e.jsx("option",{value:"Low",children:"Basse"}),e.jsx("option",{value:"Medium",children:"Moyenne"}),e.jsx("option",{value:"High",children:"Haute"})]})})]}),e.jsxs(i,{className:"mb-3",children:[e.jsx(r,{children:e.jsx(g,{type:"date",label:"Date d'échéance",name:"dueDate",value:s.dueDate,onChange:o})}),e.jsx(r,{children:e.jsxs(p,{label:"Assigné à",name:"assignedTo",value:s.assignedTo,onChange:o,children:[e.jsx("option",{value:"",children:"Sélectionner un utilisateur"}),k.map(t=>e.jsxs("option",{value:t._id,children:[t.name," (",t.email,")"]},t._id))]})})]}),e.jsx(i,{className:"mb-3",children:e.jsx(r,{children:e.jsxs(p,{label:"Projet",name:"project",value:s.project,onChange:o,children:[e.jsx("option",{value:"",children:"Sélectionner un projet"}),f.map(t=>e.jsx("option",{value:t._id,children:t.projectName},t._id))]})})}),e.jsx(i,{children:e.jsxs(r,{children:[e.jsx(C,{type:"submit",color:"primary",children:"Modifier"}),e.jsx(C,{type:"button",color:"secondary",className:"ms-2",onClick:()=>x("/tasks"),children:"Annuler"})]})})]})})]})})})};export{M as default};
