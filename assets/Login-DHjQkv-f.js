import{r as o,u as z,y as W,j as e,C as L,a as w,b as h,c as S,d as b,e as Y,f as x,F as E,g as J,h as Q,L as P,i as c,k as V,l as X,m as K,n as O,o as B,p as q,q as _,s as A}from"./index-CQXiZoZy.js";import{C as $}from"./CCardGroup-Cc5vEPUM.js";import{C as ee}from"./CInputGroupText-Bq26XuDw.js";const ie="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPCEtLSBCYWNrZ3JvdW5kIGVsZW1lbnRzIC0tPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iMjUwIiByPSIxMDAiIGZpbGw9IiNGMEY0RkYiIG9wYWNpdHk9IjAuNSIvPgogIDxjaXJjbGUgY3g9IjM1MCIgY3k9IjUwIiByPSI4MCIgZmlsbD0iI0YwRjRGRiIgb3BhY2l0eT0iMC4zIi8+CiAgCiAgPCEtLSBQcm9qZWN0IGJvYXJkIC0tPgogIDxyZWN0IHg9IjgwIiB5PSI2MCIgd2lkdGg9IjI0MCIgaGVpZ2h0PSIxODAiIHJ4PSIxMiIgZmlsbD0iI0YwRjRGRiIgc3Ryb2tlPSIjRTBFNkZGIiBzdHJva2Utd2lkdGg9IjIiLz4KICAKICA8IS0tIEJvYXJkIGhlYWRlciAtLT4KICA8cmVjdCB4PSI4MCIgeT0iNjAiIHdpZHRoPSIyNDAiIGhlaWdodD0iMzYiIHJ4PSIxMiIgZmlsbD0iIzQzNjFFRSIvPgogIDxyZWN0IHg9IjgwIiB5PSI4NCIgd2lkdGg9IjI0MCIgaGVpZ2h0PSIxMiIgcng9IjAiIGZpbGw9IiM0MzYxRUUiLz4KICAKICA8IS0tIENvbHVtbiB0aXRsZXMgLS0+CiAgPHRleHQgeD0iMTIwIiB5PSI4MiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0iNjAwIiBmaWxsPSJ3aGl0ZSI+VG8gRG88L3RleHQ+CiAgPHRleHQgeD0iMjAwIiB5PSI4MiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0iNjAwIiBmaWxsPSJ3aGl0ZSI+SW4gUHJvZ3Jlc3M8L3RleHQ+CiAgPHRleHQgeD0iMjgwIiB5PSI4MiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0iNjAwIiBmaWxsPSJ3aGl0ZSI+VGVzdGluZzwvdGV4dD4KICAKICA8IS0tIENvbHVtbiBkaXZpZGVycyAtLT4KICA8bGluZSB4MT0iMTYwIiB5MT0iNjAiIHgyPSIxNjAiIHkyPSIyNDAiIHN0cm9rZT0iI0UwRTZGRiIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPGxpbmUgeDE9IjI0MCIgeTE9IjYwIiB4Mj0iMjQwIiB5Mj0iMjQwIiBzdHJva2U9IiNFMEU2RkYiIHN0cm9rZS13aWR0aD0iMSIvPgogIAogIDwhLS0gVGFzayBjYXJkcyBpbiBUbyBEbyBjb2x1bW4gLS0+CiAgPHJlY3QgeD0iOTAiIHk9IjExMCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0id2hpdGUiIHN0cm9rZT0iI0UwRTZGRiIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPHJlY3QgeD0iOTAiIHk9IjE0NCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0id2hpdGUiIHN0cm9rZT0iI0UwRTZGRiIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPHJlY3QgeD0iOTAiIHk9IjE3OCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0id2hpdGUiIHN0cm9rZT0iI0UwRTZGRiIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPHJlY3QgeD0iOTAiIHk9IjIxMiIgd2lkdGg9IjYwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0id2hpdGUiIHN0cm9rZT0iI0UwRTZGRiIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgCiAgPCEtLSBUYXNrIGNhcmRzIGluIEluIFByb2dyZXNzIGNvbHVtbiAtLT4KICA8cmVjdCB4PSIxNzAiIHk9IjExMCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0id2hpdGUiIHN0cm9rZT0iI0UwRTZGRiIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPHJlY3QgeD0iMTcwIiB5PSIxNDQiIHdpZHRoPSI2MCIgaGVpZ2h0PSIyNCIgcng9IjQiIGZpbGw9IndoaXRlIiBzdHJva2U9IiNFMEU2RkYiIHN0cm9rZS13aWR0aD0iMSIvPgogIDxyZWN0IHg9IjE3MCIgeT0iMTc4IiB3aWR0aD0iNjAiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSJ3aGl0ZSIgc3Ryb2tlPSIjRTBFNkZGIiBzdHJva2Utd2lkdGg9IjEiLz4KICAKICA8IS0tIFRhc2sgY2FyZHMgaW4gVGVzdGluZyBjb2x1bW4gLS0+CiAgPHJlY3QgeD0iMjUwIiB5PSIxMTAiIHdpZHRoPSI2MCIgaGVpZ2h0PSIyNCIgcng9IjQiIGZpbGw9IndoaXRlIiBzdHJva2U9IiNFMEU2RkYiIHN0cm9rZS13aWR0aD0iMSIvPgogIDxyZWN0IHg9IjI1MCIgeT0iMTQ0IiB3aWR0aD0iNjAiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSJ3aGl0ZSIgc3Ryb2tlPSIjRTBFNkZGIiBzdHJva2Utd2lkdGg9IjEiLz4KICAKICA8IS0tIFBlcnNvbiAxIC0tPgogIDxjaXJjbGUgY3g9IjQwIiBjeT0iMTAwIiByPSIyMCIgZmlsbD0iIzQzNjFFRSIgb3BhY2l0eT0iMC4yIi8+CiAgPHBhdGggZD0iTTQwIDkwIFE0NSA4NSA1MCA5MCBRNTUgOTUgNTAgMTAwIFE0NSAxMDUgNDAgMTAwIFEzNSA5NSA0MCA5MCIgZmlsbD0iIzQzNjFFRSIvPgogIDxjaXJjbGUgY3g9IjQwIiBjeT0iODAiIHI9IjEwIiBmaWxsPSIjNDM2MUVFIi8+CiAgPHJlY3QgeD0iMzAiIHk9IjkwIiB3aWR0aD0iMjAiIGhlaWdodD0iMjUiIHJ4PSI1IiBmaWxsPSIjNDM2MUVFIi8+CiAgCiAgPCEtLSBQZXJzb24gMiAtLT4KICA8Y2lyY2xlIGN4PSIzNDAiIGN5PSIyMDAiIHI9IjIwIiBmaWxsPSIjRkY1MjUyIiBvcGFjaXR5PSIwLjIiLz4KICA8cGF0aCBkPSJNMzQwIDE5MCBRMzQ1IDE4NSAzNTAgMTkwIFEzNTUgMTk1IDM1MCAyMDAgUTM0NSAyMDUgMzQwIDIwMCBRMzM1IDE5NSAzNDAgMTkwIiBmaWxsPSIjRkY1MjUyIi8+CiAgPGNpcmNsZSBjeD0iMzQwIiBjeT0iMTgwIiByPSIxMCIgZmlsbD0iI0ZGNTI1MiIvPgogIDxyZWN0IHg9IjMzMCIgeT0iMTkwIiB3aWR0aD0iMjAiIGhlaWdodD0iMjUiIHJ4PSI1IiBmaWxsPSIjRkY1MjUyIi8+CiAgCiAgPCEtLSBDaGFydCAtLT4KICA8cmVjdCB4PSIzMCIgeT0iMjIwIiB3aWR0aD0iODAiIGhlaWdodD0iNDAiIHJ4PSI0IiBmaWxsPSJ3aGl0ZSIgc3Ryb2tlPSIjRTBFNkZGIiBzdHJva2Utd2lkdGg9IjEiLz4KICA8cG9seWxpbmUgcG9pbnRzPSI0MCwyNTAgNTUsMjM1IDcwLDI0NSA4NSwyMjAiIHN0cm9rZT0iIzQzNjFFRSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CiAgPGNpcmNsZSBjeD0iNDAiIGN5PSIyNTAiIHI9IjMiIGZpbGw9IiM0MzYxRUUiLz4KICA8Y2lyY2xlIGN4PSI1NSIgY3k9IjIzNSIgcj0iMyIgZmlsbD0iIzQzNjFFRSIvPgogIDxjaXJjbGUgY3g9IjcwIiBjeT0iMjQ1IiByPSIzIiBmaWxsPSIjNDM2MUVFIi8+CiAgPGNpcmNsZSBjeD0iODUiIGN5PSIyMjAiIHI9IjMiIGZpbGw9IiM0MzYxRUUiLz4KICAKICA8IS0tIFRhc2sgc3F1YXJlcyAtLT4KICA8cmVjdCB4PSIzMjAiIHk9IjEyMCIgd2lkdGg9IjMwIiBoZWlnaHQ9IjMwIiByeD0iNCIgZmlsbD0iIzQzNjFFRSIgb3BhY2l0eT0iMC4yIi8+CiAgPHJlY3QgeD0iMzMwIiB5PSIxMzAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgcng9IjIiIGZpbGw9IiM0MzYxRUUiLz4KICAKICA8cmVjdCB4PSI1MCIgeT0iMTcwIiB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHJ4PSI0IiBmaWxsPSIjRkY1MjUyIiBvcGFjaXR5PSIwLjIiLz4KICA8cmVjdCB4PSI1OCIgeT0iMTc4IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiByeD0iMiIgZmlsbD0iI0ZGNTI1MiIvPgogIAogIDwhLS0gQXJyb3cgLS0+CiAgPHBhdGggZD0iTTM1MCAyNTAgTDM4MCAyNTAgTDM3MCAyNDAgTTM4MCAyNTAgTDM3MCAyNjAiIHN0cm9rZT0iIzQzNjFFRSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=",Ie=()=>{const[n,D]=o.useState(""),[j,G]=o.useState(""),[u,C]=o.useState(""),[y,g]=o.useState(!1),[m,Z]=o.useState(""),[p,l]=o.useState(""),[M,R]=o.useState(null),[N,T]=o.useState(!1),[H,f]=o.useState(!1),t=z();async function k(a){var I,r,d,s;a.preventDefault(),C(""),l(""),console.log("Attempting to login with email:",n);try{console.log("Sending login request to:",A.defaults.baseURL+"/api/auth/login");const i=await A.post("/api/auth/login",{email:n,password:j});if(console.log("Login response:",i.data),i.data.success){if(i.data.requireTwoFactor){console.log("2FA is required for this account"),R({email:n,password:j,userId:i.data.userId}),g(!0);return}if(console.log("Login successful, full response:",i.data),localStorage.setItem("token",i.data.token),console.log("Token stored from login:",i.data.token),i.data.user){if(i.data.user.role&&(localStorage.setItem("userRole",i.data.user.role),console.log("User role stored:",i.data.user.role)),i.data.user.name&&(localStorage.setItem("userName",i.data.user.name),console.log("User name stored:",i.data.user.name)),i.data.user._id&&(localStorage.setItem("userId",i.data.user._id),console.log("User ID stored:",i.data.user._id)),i.data.user.role==="Admin"){console.log("Admin user detected, redirecting to admin redirect page"),console.log("Admin user details:",i.data.user),setTimeout(()=>{console.log("Now navigating to admin redirect page"),t("/admin-redirect")},500);return}}else console.error("User role not found in response:",i.data);t("/dashboard")}else C(i.data.error||"Login failed")}catch(i){console.error("Login error details:",{message:i.message,response:(I=i.response)==null?void 0:I.data,status:(r=i.response)==null?void 0:r.status}),C(((s=(d=i.response)==null?void 0:d.data)==null?void 0:s.error)||"An error occurred during login")}}async function v(){var a,I,r,d;if(l(""),!m){l("Please enter the verification code");return}try{console.log("Sending 2FA verification request"),console.log("2FA code entered:",m),console.log("User data:",M);const s=m.toString().replace(/\s+/g,"");console.log("Cleaned 2FA code:",s);const i=await A.post("/api/auth/login",{email:M.email,password:M.password,twoFactorCode:s});if(console.log("2FA response:",i.data),i.data.success){if(console.log("2FA login successful, full response:",i.data),g(!1),localStorage.setItem("token",i.data.token),console.log("Token stored from 2FA login:",i.data.token),i.data.user){if(i.data.user.role&&(localStorage.setItem("userRole",i.data.user.role),console.log("User role stored from 2FA:",i.data.user.role)),i.data.user.name&&(localStorage.setItem("userName",i.data.user.name),console.log("User name stored from 2FA:",i.data.user.name)),i.data.user._id&&(localStorage.setItem("userId",i.data.user._id),console.log("User ID stored from 2FA:",i.data.user._id)),i.data.user.role==="Admin"){console.log("Admin user detected from 2FA, redirecting to admin redirect page"),t("/admin-redirect");return}}else console.error("User role not found in 2FA response:",i.data);t("/dashboard")}else l(i.data.error||"Verification failed")}catch(s){console.error("2FA verification error details:",{message:s.message,response:(a=s.response)==null?void 0:a.data,status:(I=s.response)==null?void 0:I.status});const i=((d=(r=s.response)==null?void 0:r.data)==null?void 0:d.error)||"An error occurred during verification";console.error("2FA error message:",i),l(i),i.includes("invalid")&&l(i+". Please make sure you are entering the current code from your authenticator app.")}}o.useEffect(()=>{const a=new URLSearchParams(window.location.search),I=a.get("token");if(a.get("error")){W.error("Authentication failed. Please try again.");return}I&&(localStorage.setItem("token",I),t("/dashboard"))},[t]);const F=()=>{localStorage.removeItem("token"),window.location.href="http://localhost:3001/auth/google?scope=profile%20email"},U=()=>{localStorage.removeItem("token"),window.location.href="http://localhost:3001/api/auth/facebook"};return e.jsxs("div",{className:"login-page",children:[e.jsx(L,{children:e.jsx(w,{className:"justify-content-center",children:e.jsxs(h,{md:10,lg:9,xl:8,children:[e.jsx("div",{className:"text-center mb-4",children:e.jsx("h1",{className:"worktrack-logo",children:"WorkTrack"})}),e.jsx(S,{className:"login-card",children:e.jsxs($,{children:[e.jsx(S,{className:"login-form-container border-0",children:e.jsx(b,{children:e.jsxs(Y,{onSubmit:k,children:[e.jsx("h2",{children:"Login"}),e.jsx("p",{className:"text-muted mb-4",children:"Sign in to your account"}),u&&e.jsx("div",{className:"alert alert-danger",children:u}),e.jsxs("div",{className:"form-floating mb-3",children:[e.jsx(x,{id:"floatingEmail",placeholder:"Email",autoComplete:"email",value:n,onChange:a=>D(a.target.value)}),e.jsx("label",{htmlFor:"floatingEmail",children:"Email address"})]}),e.jsxs("div",{className:"form-floating mb-4 position-relative",children:[e.jsx(x,{id:"floatingPassword",type:N?"text":"password",placeholder:"Password",autoComplete:"current-password",value:j,onChange:a=>G(a.target.value)}),e.jsx("label",{htmlFor:"floatingPassword",children:"Password"}),e.jsx("div",{className:"password-toggle",onClick:()=>T(!N),children:N?e.jsx(E,{size:16}):e.jsx(J,{size:16})})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(h,{xs:6,children:e.jsx(Q,{id:"rememberMe",label:"Remember me",checked:H,onChange:a=>f(a.target.checked)})}),e.jsx(h,{xs:6,className:"text-end",children:e.jsx(P,{to:"/forgot-password",className:"text-decoration-none",children:"Forgot password?"})})]}),e.jsx(c,{color:"primary",className:"login-button",type:"submit",children:"Login"}),e.jsxs("div",{className:"social-login-section",children:[e.jsx("div",{className:"social-login-divider",children:e.jsx("span",{children:"Or continue with"})}),e.jsxs("div",{className:"social-login-buttons",children:[e.jsxs(c,{className:"social-login-button",onClick:F,children:[e.jsx("div",{className:"google-icon-wrapper",children:e.jsxs("svg",{className:"google-icon",width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]})}),"Google"]}),e.jsxs(c,{className:"social-login-button",onClick:U,children:[e.jsx("div",{className:"facebook-icon-wrapper",children:e.jsx("svg",{className:"facebook-icon",width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"#1877F2",d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})}),"Facebook"]})]}),e.jsxs("div",{className:"register-link",children:["Don't have an account? ",e.jsx(P,{to:"/register",children:"Sign up"})]})]})]})})}),e.jsx(S,{className:"login-sidebar d-none d-md-block",style:{width:"50%"},children:e.jsxs(b,{className:"d-flex flex-column justify-content-center",children:[e.jsx("h3",{className:"login-sidebar-title",children:"Check Your Project Progress"}),e.jsx("p",{className:"text-muted mb-4",children:"Track tasks, manage projects, and collaborate with your team efficiently."}),e.jsx("div",{className:"project-illustration",children:e.jsx("img",{src:ie,alt:"Project Management",className:"login-sidebar-image"})}),e.jsxs("div",{className:"login-sidebar-dots",children:[e.jsx("div",{className:"login-sidebar-dot active"}),e.jsx("div",{className:"login-sidebar-dot"}),e.jsx("div",{className:"login-sidebar-dot"})]})]})})]})})]})})}),e.jsxs(V,{visible:y,onClose:()=>g(!1),alignment:"center",children:[e.jsx(X,{className:"border-bottom-0 pb-0",children:e.jsx(K,{className:"fw-bold",children:"Two-Factor Authentication"})}),e.jsxs(O,{className:"pt-0",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"two-factor-icon-container",children:e.jsx(B,{size:24,className:"text-primary"})}),e.jsx("p",{className:"mb-1",children:"Please enter the verification code from your authenticator app"}),e.jsx("p",{className:"text-muted small",children:"The code refreshes every 30 seconds"})]}),p&&e.jsx("div",{className:"alert alert-danger",children:p}),e.jsxs(q,{className:"mb-4",children:[e.jsx(ee,{children:e.jsx(B,{})}),e.jsx(x,{type:"text",placeholder:"Enter 6-digit code",value:m,onChange:a=>Z(a.target.value),className:"form-control-lg two-factor-input",maxLength:"6"})]})]}),e.jsxs(_,{className:"border-top-0 pt-0",children:[e.jsx(c,{color:"secondary",onClick:()=>g(!1),className:"px-4",children:"Cancel"}),e.jsx(c,{color:"primary",onClick:v,className:"login-button",children:"Verify"})]})]})]})};export{Ie as default};
