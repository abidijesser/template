import{x as F,u as G,r as c,s as V,j as e,C as j,a as d,b as n,w as D,c as p,z as N,d as f,t as l,G as C,e as $,H,p as J,f as K,i as o,A as _,I as O,J as Q,K as W,M as X,N as z,y as Y}from"./index-CQXiZoZy.js";import{C as Z}from"./CInputGroupText-Bq26XuDw.js";var P=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='497.333 239.999 80.092 239.999 176.087 144.004 153.46 121.377 18.837 256 153.46 390.623 176.087 367.996 80.09 271.999 497.333 271.999 497.333 239.999' class='ci-primary'/>"];const re=()=>{var k;const{token:m}=F(),g=G(),[I,y]=c.useState(!0),[v,u]=c.useState(null),[s,T]=c.useState(null),[r,R]=c.useState(null),[U,w]=c.useState(!1),[x,q]=c.useState(""),[b,S]=c.useState(!1);c.useEffect(()=>{m&&L()},[m]);const L=async(a=null)=>{var h,t,E,A;try{y(!0),u(null);const i=await V.post(`/share/validate/${m}`,{password:a});i.data.success?(T(i.data.data.document),R(i.data.data.accessLevel),w(!1)):u("Lien de partage invalide ou expiré")}catch(i){console.error("Erreur lors de la validation du lien de partage:",i),(t=(h=i.response)==null?void 0:h.data)!=null&&t.requiresPassword?(w(!0),u(null)):u(((A=(E=i.response)==null?void 0:E.data)==null?void 0:A.error)||"Lien de partage invalide ou expiré")}finally{y(!1)}},M=async a=>{if(a.preventDefault(),!!x.trim())try{S(!0),await L(x)}finally{S(!1)}},B=()=>{if(s)try{const h=`http://localhost:3001/api/share/public/download/${m}`,t=window.document.createElement("a");t.href=h,t.setAttribute("download",s.name),window.document.body.appendChild(t),t.click(),window.document.body.removeChild(t)}catch(a){console.error("Erreur lors du téléchargement du document:",a),Y.error("Erreur lors du téléchargement du document")}};return I?e.jsx(j,{className:"mt-5",children:e.jsx(d,{className:"justify-content-center",children:e.jsx(n,{md:8,lg:6,xl:5,children:e.jsxs("div",{className:"text-center my-5",children:[e.jsx(D,{color:"primary"}),e.jsx("p",{className:"mt-3",children:"Chargement du document partagé..."})]})})})}):U?e.jsx(j,{className:"mt-5",children:e.jsx(d,{className:"justify-content-center",children:e.jsx(n,{md:8,lg:6,xl:5,children:e.jsxs(p,{className:"password-card",children:[e.jsx(N,{className:"text-center",children:e.jsx("h4",{children:"Document protégé par mot de passe"})}),e.jsxs(f,{children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(l,{icon:C,size:"3xl",className:"text-warning mb-3"}),e.jsx("p",{children:"Ce document est protégé par un mot de passe. Veuillez saisir le mot de passe pour y accéder."})]}),e.jsxs($,{onSubmit:M,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(H,{children:"Mot de passe"}),e.jsxs(J,{children:[e.jsx(Z,{children:e.jsx(l,{icon:C})}),e.jsx(K,{type:"password",value:x,onChange:a=>q(a.target.value),placeholder:"Entrez le mot de passe",required:!0})]})]}),e.jsx("div",{className:"d-grid",children:e.jsx(o,{color:"primary",type:"submit",disabled:b||!x.trim(),children:b?e.jsx(D,{size:"sm"}):"Accéder au document"})})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsx(o,{color:"link",onClick:()=>g("/"),children:"Retour à l'accueil"})})]})]})})})}):v?e.jsx(j,{className:"mt-5",children:e.jsx(d,{className:"justify-content-center",children:e.jsx(n,{md:8,lg:6,xl:5,children:e.jsxs(_,{color:"danger",className:"text-center",children:[e.jsx("h4",{className:"alert-heading",children:"Erreur"}),e.jsx("p",{children:v}),e.jsx("hr",{}),e.jsx("div",{className:"d-grid",children:e.jsxs(o,{color:"primary",onClick:()=>g("/"),children:[e.jsx(l,{icon:P,className:"me-2"}),"Retour à l'accueil"]})})]})})})}):e.jsx(j,{className:"mt-4",children:e.jsx(d,{children:e.jsxs(n,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{children:s.name}),e.jsxs("div",{children:[e.jsxs(o,{color:"primary",onClick:B,className:"me-2",children:[e.jsx(l,{icon:O,className:"me-2"}),"Télécharger"]}),e.jsxs(o,{color:"secondary",variant:"outline",onClick:()=>g("/"),children:[e.jsx(l,{icon:P,className:"me-2"}),"Retour"]})]})]}),e.jsx(p,{className:"mb-4",children:e.jsx(f,{children:e.jsxs(d,{children:[e.jsx(n,{md:8,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.description||"Aucune description"]})}),e.jsxs(n,{md:4,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(k=s.fileType)==null?void 0:k.toUpperCase()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Taille:"})," ",s.fileSize]})]})]})})}),e.jsxs(d,{children:[e.jsx(n,{lg:8,children:e.jsx(Q,{document:s})}),e.jsxs(n,{lg:4,children:[r==="comment"||r==="edit"?e.jsx(W,{documentId:s._id}):e.jsxs(p,{children:[e.jsx(N,{children:"Commentaires"}),e.jsx(f,{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"Vous n'avez pas la permission d'ajouter des commentaires à ce document."})})]}),e.jsxs(p,{className:"mt-4 security-info-card",children:[e.jsxs(N,{children:[e.jsx(l,{icon:X,className:"me-2"}),"Informations de sécurité"]}),e.jsxs(f,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Type de fichier:"})," ",s.fileType.toUpperCase(),e.jsx(z,{color:"success",className:"ms-2",title:"Le type de fichier est vérifié pour assurer l'intégrité du document",children:"Vérifié"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Niveau d'accès:"})," ",e.jsxs(z,{color:r==="view"?"info":r==="comment"?"primary":"success",children:[r==="view"&&"Lecture seule",r==="comment"&&"Commentaires",r==="edit"&&"Modification"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Modifications:"})," ",r==="edit"?e.jsx("span",{className:"text-success",children:"Autorisées"}):e.jsx("span",{className:"text-danger",children:"Non autorisées"})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("strong",{children:"Protection:"})," ",e.jsx(l,{icon:C,className:"text-primary me-1",size:"sm"}),"Le document est protégé contre les modifications de type et de format"]})]})]})]})]})]})})})};export{re as default};
