import{s as h,O as p,r as c,j as n,w as S,Q as i,P as u}from"./index-CQXiZoZy.js";import R from"./ErrorBoundary-CR1YVe9X.js";const g=()=>localStorage.getItem("token")!==null,d=async()=>{try{return localStorage.getItem("token")?(await h.get("/api/auth/profile")).data.user:null}catch(o){return console.error("Error fetching current user:",o),null}},y=async()=>{try{console.log("isAdmin function called");const o=localStorage.getItem("userRole");if(console.log("Role from localStorage:",o),o){const t=o==="Admin";return console.log("Is admin based on localStorage:",t),t}console.log("No role in localStorage, checking with server");const e=await d();console.log("User from server:",e);const r=e&&e.role==="Admin";return console.log("Is admin based on server response:",r),e&&e.role&&(console.log("Storing role in localStorage:",e.role),localStorage.setItem("userRole",e.role)),r}catch(o){return console.error("Error checking admin role:",o),!1}},k=async()=>{try{console.log("isClient function called");const o=localStorage.getItem("userRole");if(console.log("Role from localStorage:",o),o){const t=o==="Client";return console.log("Is client based on localStorage:",t),t}console.log("No role in localStorage, checking with server");const e=await d();console.log("User from server:",e);const r=e&&e.role==="Client";return console.log("Is client based on server response:",r),e&&e.role&&(console.log("Storing role in localStorage:",e.role),localStorage.setItem("userRole",e.role)),r}catch(o){return console.error("Error checking client role:",o),!1}},A=({children:o,adminOnly:e=!1})=>{const r=p(),[t,l]=c.useState(!0),[f,m]=c.useState(!1);return c.useEffect(()=>{(async()=>{try{if(!g()){l(!1);return}const s=await y();console.log("Is admin user:",s);const a=s||!e&&await k();console.log("Role check:",{adminOnly:e,isAdminUser:s,hasCorrectRole:a}),m(a),l(!1)}catch(s){console.error("Error checking authentication:",s),l(!1)}})()},[e]),t?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:n.jsx(S,{color:"primary"})}):g()?f?n.jsx(R,{children:o}):n.jsx(i,{to:"/unauthorized",state:{from:r},replace:!0}):n.jsx(i,{to:"/login",state:{from:r},replace:!0})};A.propTypes={children:u.node.isRequired,adminOnly:u.bool};export{A as default};
